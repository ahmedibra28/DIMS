generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  email               String   @unique
  name                String
  image               String?
  mobile              Int?
  address             String?
  bio                 String?
  password            String
  confirmed           Boolean  @default(false)
  blocked             Boolean  @default(false)
  resetPasswordToken  String?
  resetPasswordExpire BigInt?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  role   Role   @relation(fields: [roleId], references: [id], onDelete: Restrict)
  roleId String

  @@map("users")
}

model Role {
  id          String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  name        String   @unique
  type        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users             User[]
  permissions       Permission[]
  clientPermissions ClientPermission[]

  @@map("roles")
}

model Permission {
  id          String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  name        String
  method      Method
  route       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  role Role[]

  @@unique([method, route])
  @@map("permissions")
}

model ClientPermission {
  id          String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  name        String   @unique
  sort        Int
  menu        String
  path        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  role Role[]

  @@map("client_permissions")
}

model School {
  id        String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  name      String
  status    Status   @default(ACTIVE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course[]

  @@map("schools")
}

model Course {
  id           String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  name         String
  price        Float    @default(0)
  duration     Int
  examinations String[]
  certificate  String?
  enrolment    String?
  status       Status   @default(ACTIVE)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  school   School    @relation(fields: [schoolId], references: [id], onDelete: Restrict)
  schoolId String
  subject  Subject[]

  @@map("courses")
}

model Subject {
  id             String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  name           String
  semester       Int
  theoryMarks    Int
  practicalMarks Int
  status         Status   @default(ACTIVE)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  course   Course @relation(fields: [courseId], references: [id], onDelete: Restrict)
  courseId String

  @@unique([semester, name, courseId])
  @@map("subjects")
}

model Student {
  id                String        @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  rollNo            String
  name              String
  placeOfBirth      String
  dateOfBirth       String
  nationality       String
  sex               Sex
  education         String
  district          String
  mobile            Int
  contactName       String
  contactMobile     Int
  contactEmail      String
  contactRelation   String
  somaliLanguage    LanguageLevel
  arabicLanguage    LanguageLevel
  englishLanguage   LanguageLevel
  kiswahiliLanguage LanguageLevel
  image             String?
  note              String?
  status            Status        @default(ACTIVE)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@map("students")
}

model Instructor {
  id              String   @id @default(dbgenerated("nanoid()")) @db.VarChar(21)
  rollNo          String
  name            String
  placeOfBirth    String
  dateOfBirth     String
  nationality     String
  sex             Sex
  email           String
  qualification   String
  experience      String
  district        String
  mobile          Int
  contactName     String
  contactMobile   Int
  contactEmail    String
  contactRelation String
  image           String?
  note            String?
  status          Status   @default(ACTIVE)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("instructors")
}

enum Method {
  GET
  POST
  PUT
  DELETE
}

enum Status {
  ACTIVE
  INACTIVE
  DELETED
}

enum Sex {
  MALE
  FEMALE
}

enum LanguageLevel {
  FLUENT
  GOOD
  FAIR
}
